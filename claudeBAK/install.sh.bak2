#!/bin/bash

# Check if gum is installed
if ! command -v gum &> /dev/null;
then
    echo "gum is not installed. It is required for the interactive menu."
    read -p "Do you want to install gum? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]
    then
        if [[ "$OSTYPE" == "darwin"* ]]
        then
            brew install gum
        else
            echo "Please install gum manually from https://github.com/charmbracelet/gum"
            exit 1
        fi
    else
        exit 1
    fi
fi

# --- Main Menu ---
gum style --border normal --margin "1" --padding "1 2" --border-foreground 212 "Welcome to your dotfiles installer!"

# --- Dependency-related choices first ---
gum style "First, let's select your terminal and shell."
choices=$(gum choose --no-limit "Zsh + Prezto" "Kitty terminal")

# --- Dependent choices ---
if [[ "$choices" == *"Kitty terminal"* ]]
then
    gum style "Since you chose Kitty, you can also install these plugins:"
    dependent_choices=$(gum choose --no-limit "Awrit" "vim-kitty-navigator")
    choices="$choices
$dependent_choices"
fi

# --- Other choices ---
gum style "Select other tools to install:"
other_choices=$(gum choose --no-limit "Git" "Tmux" "Homebrew" "GrumpyVim" "Linting" "Yazi")
choices="$choices
$other_choices"


# --- Installation ---
gum style "Starting installation..."

if [[ "$choices" == *"Zsh + Prezto"* ]]
then
    ./bin/install_zsh.sh
fi
if [[ "$choices" == *"Kitty terminal"* ]]
then
    ./bin/install_kitty.sh
fi
if [[ "$choices" == *"Awrit"* ]]
then
    ./bin/install_awrit.sh
fi
if [[ "$choices" == *"vim-kitty-navigator"* ]]
then
    ./bin/install_vim-kitty-navigator.sh
fi
if [[ "$choices" == *"Git"* ]]
then
    ./bin/install_git.sh
fi
if [[ "$choices" == *"Tmux"* ]]
then
    ./bin/install_tmux.sh
fi
if [[ "$choices" == *"Homebrew"* ]]
then
    ./bin/install_homebrew.sh
fi
if [[ "$choices" == *"GrumpyVim"* ]]
then
    ./bin/install_grumpyvim.sh
fi
if [[ "$choices" == *"Linting"* ]]
then
    ./bin/install_linting.sh
fi
if [[ "$choices" == *"Yazi"* ]]
then
    ./bin/install_yazi.sh
fi

gum style --foreground 212 "Installation complete!"
